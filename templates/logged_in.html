<!DOCTYPE html>
<html>
    <head>
        <title>Google Picker Example</title>
    </head>
    <body>
        <button id="pick">Pick File</button>

        <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
        <script>
            var clientId = '';
            var developerKey = '';
            var pickerApiLoaded = false;
            var oauthToken;

            function onApiLoad() {
                gapi.load('auth', {'callback': onAuthApiLoad});
                gapi.load('picker', {'callback': onPickerApiLoad});
            }

            function onAuthApiLoad() {
                window.gapi.auth.authorize({
                    'client_id': clientId,
                    'scope': 'https://www.googleapis.com/auth/drive.readonly',
                    'immediate': false
                }, handleAuthResult);
            }

            function onPickerApiLoad() {
                pickerApiLoaded = true;
                createPicker();
            }

            function handleAuthResult(authResult) {
                if (authResult && !authResult.error) {
                    oauthToken = authResult.access_token;
                    createPicker();
                }
            }

            function createPicker() {
                if (pickerApiLoaded && oauthToken) {
                    var picker = new google.picker.PickerBuilder()
                        .addView(google.picker.ViewId.DOCS)
                        .setOAuthToken(oauthToken)
                        .setDeveloperKey(developerKey)
                        .setCallback(pickerCallback)
                        .build();
                    picker.setVisible(true);
                }
            }

            function pickerCallback(data) {
                if (data.action == google.picker.Action.PICKED) {
                    var fileId = data.docs[0].id;
                    alert('Picked: ' + fileId);
                }
            }

            document.getElementById('pick').addEventListener('click', onApiLoad);
        </script>
    </body>
</html>
